<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoanApprovalPredictionService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">mybank</a> &gt; <a href="index.source.html" class="el_package">com.mybank.service</a> &gt; <span class="el_source">LoanApprovalPredictionService.java</span></div><h1>LoanApprovalPredictionService.java</h1><pre class="source lang-java linenums">	package com.mybank.service;
	
	import java.io.InputStream;
	import java.io.OutputStream;
	import java.net.HttpURLConnection;
	import java.net.URL;
	import java.nio.charset.StandardCharsets;
	
	import jakarta.enterprise.context.ApplicationScoped;
	import jakarta.inject.Named;
	import jakarta.json.Json;
	import jakarta.json.JsonObject;
	import jakarta.json.JsonReader;
	
	@Named
	@ApplicationScoped
<span class="fc" id="L17">	public class LoanApprovalPredictionService {</span>
	
	    public PredictionResult predictLoanApproval(
	            int age,
	            int scoreCredit,
	            String statutEmploi,
	            double montantDemande,
	            int dureeMois,
	            String statutMatrimonial,
	            String statutPropriete,
	            double revenuMensuel,
	            double tauxEndettement,
	            int precedentsDefautsPret,
	            int historiquePaiement,
	            int historiqueFaillite,
	            double mensualiteEstimee,
	            double paiementsMensuelsDette,
	            double valeurNette,
	            double tauxAnnuel 
	    ) {
<span class="fc" id="L37">	    	HttpURLConnection conn = null;</span>
	    	try {
<span class="fc" id="L39">	    	    URL url = new URL(&quot;http://localhost:5000/predict&quot;);</span>
<span class="fc" id="L40">	    	    conn = (HttpURLConnection) url.openConnection();</span>
<span class="fc" id="L41">	            conn.setRequestMethod(&quot;POST&quot;);</span>
<span class="fc" id="L42">	            conn.setRequestProperty(&quot;Content-Type&quot;, &quot;application/json; utf-8&quot;);</span>
<span class="fc" id="L43">	            conn.setRequestProperty(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<span class="fc" id="L44">	            conn.setDoOutput(true);</span>
	
	            // JSON body string
<span class="fc" id="L47">	            String jsonInputString = String.format(</span>
	                    &quot;{&quot; +
	                    &quot;\&quot;Age\&quot;: %d,&quot; +
	                    &quot;\&quot;ScoreCredit\&quot;: %d,&quot; +
	                    &quot;\&quot;StatutEmploi\&quot;: \&quot;%s\&quot;,&quot; +
	                    &quot;\&quot;MontantDemande\&quot;: %.2f,&quot; +
	                    &quot;\&quot;DureeMois\&quot;: %d,&quot; +
	                    &quot;\&quot;StatutMatrimonial\&quot;: \&quot;%s\&quot;,&quot; +
	                    &quot;\&quot;StatutPropriete\&quot;: \&quot;%s\&quot;,&quot; +
	                    &quot;\&quot;RevenuMensuel\&quot;: %.2f,&quot; +
	                    &quot;\&quot;TauxEndettement\&quot;: %.4f,&quot; +
	                    &quot;\&quot;PrecedentsDefautsPret\&quot;: %d,&quot; +
	                    &quot;\&quot;HistoriquePaiement\&quot;: %d,&quot; +
	                    &quot;\&quot;HistoriqueFaillite\&quot;: %d,&quot; +
	                    &quot;\&quot;MensualiteEstimee\&quot;: %.2f,&quot; +
	                    &quot;\&quot;PaiementsMensuelsDette\&quot;: %.2f,&quot; +
	                    &quot;\&quot;ValeurNette\&quot;: %.2f,&quot; +
	                    &quot;\&quot;TauxAnnuel\&quot;: %.4f&quot; +  // âœ… NEW LINE
	                    &quot;}&quot;,
<span class="fc" id="L66">	                    age, scoreCredit, statutEmploi, montantDemande, dureeMois,</span>
<span class="fc" id="L67">	                    statutMatrimonial, statutPropriete, revenuMensuel, tauxEndettement,</span>
<span class="fc" id="L68">	                    precedentsDefautsPret, historiquePaiement, historiqueFaillite,</span>
<span class="fc" id="L69">	                    mensualiteEstimee, paiementsMensuelsDette, valeurNette, tauxAnnuel</span>
	            );
	
	            // Send POST request
<span class="nc" id="L73">	            try (OutputStream os = conn.getOutputStream()) {</span>
<span class="nc" id="L74">	                byte[] input = jsonInputString.getBytes(StandardCharsets.UTF_8);</span>
<span class="nc" id="L75">	                os.write(input, 0, input.length);</span>
	            }
	
	            // Parse JSON response
<span class="nc" id="L79">	            try (InputStream is = conn.getInputStream();</span>
<span class="nc" id="L80">	                 JsonReader reader = Json.createReader(is)) {</span>
<span class="nc" id="L81">	                JsonObject response = reader.readObject();</span>
	
<span class="nc" id="L83">	                boolean approved = response.getBoolean(&quot;loanApproved&quot;);</span>
<span class="nc" id="L84">	                double probability = response.getJsonNumber(&quot;approvalProbability&quot;).doubleValue();</span>
<span class="nc" id="L85">	                double riskScore = response.getJsonNumber(&quot;predictedRiskScore&quot;).doubleValue();</span>
	
<span class="nc" id="L87">	                return new PredictionResult(approved, probability, riskScore);</span>
	            }
	
<span class="fc" id="L90">	        } catch (Exception e) {</span>
<span class="fc" id="L91">	            e.printStackTrace();</span>
	
<span class="fc" id="L93">	            try (InputStream errorStream = conn.getErrorStream()) {</span>
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">	                if (errorStream != null) {</span>
<span class="nc" id="L95">	                    String errorResponse = new String(errorStream.readAllBytes(), StandardCharsets.UTF_8);</span>
<span class="nc" id="L96">	                    System.err.println(&quot;Error response from Flask: &quot; + errorResponse);</span>
	                }
<span class="nc" id="L98">	            } catch (Exception inner) {</span>
<span class="nc" id="L99">	                System.err.println(&quot;Failed to read error stream: &quot; + inner.getMessage());</span>
<span class="fc" id="L100">	            }</span>
	
<span class="fc" id="L102">	            return new PredictionResult(false, 0.0, -1.0);</span>
	        }
	    }
	
	    // Helper class to encapsulate results
	    public static class PredictionResult {
	        private final boolean loanApproved;
	        private final double approvalProbability;
	        private final double riskScore;
	
<span class="fc" id="L112">	        public PredictionResult(boolean loanApproved, double approvalProbability, double riskScore) {</span>
<span class="fc" id="L113">	            this.loanApproved = loanApproved;</span>
<span class="fc" id="L114">	            this.approvalProbability = approvalProbability;</span>
<span class="fc" id="L115">	            this.riskScore = riskScore;</span>
<span class="fc" id="L116">	        }</span>
	
	        public boolean isLoanApproved() {
<span class="fc" id="L119">	            return loanApproved;</span>
	        }
	
	        public double getApprovalProbability() {
<span class="fc" id="L123">	            return approvalProbability;</span>
	        }
	
	        public double getRiskScore() {
<span class="fc" id="L127">	            return riskScore;</span>
	        }
	    }
	}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>