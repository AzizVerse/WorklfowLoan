<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      lang="en"
      xml:lang="en">

<h:head>
    <title>Suivi Global des Dossiers - Responsable Analyste</title>
    <f:metadata>
    <f:event type="preRenderView" listener="#{folderBean.loadFoldersForCurrentUser}" />
</f:metadata>
 <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/css/Flow.css?v=#{System.currentTimeMillis()}"/>
</h:head>

<h:body>
<div class="content">
    <h2>üìä Suivi Global des Dossiers Assign√©s</h2>
    <p style="font-size:14px; color:gray;">
        Cette vue permet au Responsable Analyste de consulter tous les dossiers actuellement assign√©s aux analystes, toutes agences confondues.
    </p>
</div>

<h:form id="responsableForm">
    <p:panel header="Liste des Dossiers" styleClass="custom-panel">

        <p:dataTable id="folderTable"
                     var="folder"
                     value="#{folderBean.analystFolders}"
                     filteredValue="#{folderBean.filteredFolders}"
                     widgetVar="folderTableWidget"
                     scrollable="true"
                     scrollHeight="380"
                     paginator="true"
                     paginatorPosition="bottom"
                     rows="5"
                     sortBy="#{folder.createdDate}"
                     sortOrder="descending"
                     styleClass="modern-table">

            <!-- R√©f√©rence -->
            <p:column headerText="R√©f√©rence"
                      filterBy="#{folder.reference}"
                      filterMatchMode="contains"
                      filterable="true"
                      style="width: 20%;">
                <f:facet name="header">
                    <span><i class="pi pi-search" style="margin-right:5px;"></i> R√©f√©rence</span>
                </f:facet>
                <h:outputText value="#{folder.reference}" />
            </p:column>

            <!-- Client -->
            <p:column headerText="Client"
                      filterBy="#{folder.client}"
                      filterMatchMode="contains"
                      filterable="true"
                      style="width: 20%;">
                <f:facet name="header">
                    <span><i class="pi pi-search" style="margin-right:5px;"></i> Client</span>
                </f:facet>
                <h:outputText value="#{folder.client}" />
            </p:column>

            <!-- Analyste Assign√© -->
            <p:column headerText="Analyste Assign√©"
                      filterBy="#{folder.assignedTo.firstName} #{folder.assignedTo.lastName}"
                      filterMatchMode="contains"
                      filterable="true"
                      style="width: 20%;">
                <f:facet name="header">
                    <span><i class="pi pi-user" style="margin-right:5px;"></i> Analyste</span>
                </f:facet>
                <h:outputText value="#{folder.assignedTo.firstName} #{folder.assignedTo.lastName}" />
            </p:column>

            <!-- Date de cr√©ation -->
            <p:column headerText="Date de cr√©ation"
                      filterBy="#{folder.createdDate}"
                      filterMatchMode="contains"
                      filterable="true"
                      sortBy="#{folder.createdDate}"
                      style="width: 20%;">
                <f:facet name="header">
                    <span><i class="pi pi-calendar" style="margin-right:5px;"></i> Date</span>
                </f:facet>
                <h:outputText value="#{folder.createdDate}" />
            </p:column>

            <!-- Action -->
            <p:column headerText="Action" style="width: 20%; text-align: center;">
                <p:commandButton value="Voir D√©tail" icon="pi pi-eye"
                                 action="#{folderBean.selectFolder(folder)}"
                                 update=":Ra1 :Ra2"
                                 process="@this"
                                 styleClass="rounded-button ui-button-info" />
            </p:column>
        </p:dataTable>

        <!-- Reset Filters Button -->
        <p:commandButton value="üîÑ R√©initialiser les filtres"
                         icon="pi pi-filter-slash"
                         type="button"
                         onclick="PF('folderTableWidget').clearFilters();"
                         styleClass="ui-button-secondary"
                         style="margin-top: 15px;" />
    </p:panel>
</h:form>


<!-- workflow -->
    <h:form id="Ra1">
     <p:panel rendered="#{not empty folderBean.selectedFolder}">
        <div class="workflow-line">

            <!-- √âtape 1: Cr√©√© par le charg√© -->
            <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'CREE_PAR_CHARGE' or 
                                         folderBean.selectedFolder.navigation eq 'REENVOYE_AU_DIRECTEUR' or 
                                         folderBean.selectedFolder.navigation eq 'RETOURNE_AU_CHARGE' or  
                                         folderBean.selectedFolder.navigation eq 'RETOURNE_DE_Analyste' or
                                         folderBean.selectedFolder.navigation eq 'APPROUVE_PAR_DIRECTEUR' or
                                         folderBean.selectedFolder.navigation eq 'REJETE_PAR_DIRECTEUR' or
                                         folderBean.selectedFolder.navigation eq 'APPROUVE_PAR_ENGAGEMENT' or
                                         folderBean.selectedFolder.navigation eq 'REJETE_PAR_ENGAGEMENT' or
                                         folderBean.selectedFolder.navigation eq 'APPROUVE_PAR_CIC' or
                                         folderBean.selectedFolder.navigation eq 'REJETE_PAR_CIC' or
                                         folderBean.selectedFolder.navigation eq 'RETOURNE_DE_AnalysteCIC'or
                                         folderBean.selectedFolder.navigation eq 'TERMINE'
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-user-edit workflow-icon"></i>
                <div class="step-label">Charg√©</div>
            </div>

            <!-- √âtape 2: En cours chez le Directeur -->
            <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'ENVOYE_AU_DIRECTEUR' or 
                                         folderBean.selectedFolder.navigation eq 'REENVOYE_AU_DIRECTEUR' or
                                         folderBean.selectedFolder.navigation eq 'RETOUR_OFFRE'
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-user workflow-icon"></i>
                <div class="step-label">Directeur</div>
            </div>
            <div class="branch-container">
            
            <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'ENVOYE_AU_SUCCURSALE'
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-user workflow-icon"></i>
                <div class="step-label">Succursale</div>
            </div>

           
            <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'ASSIGNE_A_ANALYSTECIC' or
                                        folderBean.selectedFolder.navigation eq 'ENVOYE_AU_DIRECTEUR_CIC'
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-briefcase workflow-icon"></i>
                <div class="step-label">CIC</div>
            </div>
            
             <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'ASSIGNE_A_ANALYSTE' or
                                         folderBean.selectedFolder.navigation eq 'ENVOYE_AU_RESPONSABLE_ANALYSTE' or
                                         folderBean.selectedFolder.navigation eq 'ENVOYE_AU_DIRECTEUR_ENGAGEMENT' 
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-briefcase workflow-icon"></i>
                <div class="step-label">Engagemnt</div>
            </div>
            </div>
            
             

            <!-- √âtape 4: Statut final -->
            <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'APPROUVE_PAR_DIRECTEUR' or 
                                         folderBean.selectedFolder.navigation eq 'REJETE_PAR_DIRECTEUR' or
                                         folderBean.selectedFolder.navigation eq 'APPROUVE_PAR_ENGAGEMENT' or
                                         folderBean.selectedFolder.navigation eq 'REJETE_PAR_ENGAGEMENT' or
                                         folderBean.selectedFolder.navigation eq 'APPROUVE_PAR_CIC' or
                                         folderBean.selectedFolder.navigation eq 'REJETE_PAR_CIC' or
                                         folderBean.selectedFolder.navigation eq 'TERMINE'
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-check-circle workflow-icon"></i>
                <div class="step-label">Statut Final</div>
            </div>
             <!-- √âtape 3: Retour au Charg√© -->
            <div class="workflow-step #{folderBean.selectedFolder.navigation eq 'RETOURNE_AU_CHARGE'or 
                                         folderBean.selectedFolder.navigation eq 'RETOURNE_DE_Analyste'or
                                         folderBean.selectedFolder.navigation eq 'RETOURNE_DE_AnalysteCIC'or
                                         folderBean.selectedFolder.navigation eq 'RETOUR_OFFRE' 
                                         ? 'active-step' : 'inactive-step'}">
                <i class="pi pi-share-alt workflow-icon"></i>
                <div class="step-label">Retourn√©</div>
            </div>

        </div>
    </p:panel>
</h:form>

<!-- D√©tails du Dossier -->
<h:form id="Ra2">
    <p:panel header="D√©tails du Dossier" rendered="#{not empty folderBean.selectedFolder}">
    <f:facet name="header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h:outputText value="üìÅ Fiche du Dossier" style="font-weight: bold; font-size: 18px;" />
        <p:commandButton value="üóÇÔ∏è Voir les d√©tails"
                         icon="pi pi-eye"
                         onclick="PF('detailsDialog').show();"
                         disabled="#{empty folderBean.selectedFolder}"
                         styleClass="ui-button-outlined ui-button-secondary"
                         style="margin-left: auto; font-weight: 600;" />
    </div>
</f:facet>
<!-- üìã Full Folder Details Modal -->
<p:dialog id="detailsDialog" widgetVar="detailsDialog"
          header="D√©tails du Dossier"
          modal="true" closable="true" resizable="false"
          width="700" style="max-height: 90vh; overflow-y: auto; border-radius:10px;">

    <!-- üìÇ Folder Basic Information -->
    <h3 style="margin-top:10px;">üìÇ Informations G√©n√©rales</h3>
    <h:panelGrid columns="2" cellpadding="8" columnClasses="label,value" style="width:100%;">
        <h:outputText value="üìå R√©f√©rence:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.reference}" />

        <h:outputText value="üë§ Client:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.client}" />

        <h:outputText value="üìÑ Description:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.description}" />

        <h:outputText value="üìÖ Date de cr√©ation:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.createdDate}" />

        <h:outputText value="üí∞ Montant demand√©:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.montantDemande} TND" />

        <h:outputText value="üïí Dur√©e du Pr√™t:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.dureeMois} mois" />

        <h:outputText value="üìà Revenu Mensuel:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.revenuMensuel} TND" />

        <h:outputText value="üìä Taux Annuel d'Int√©r√™t:" styleClass="label" />
        <h:outputText value="#{folderBean.selectedFolder.tauxAnnuel} %" />
    </h:panelGrid>

    <p:separator style="margin:20px 0;" />

    <!-- üë§ Client Profile Section -->
    <h3 style="margin-top:10px;">üë§ Profil du Client</h3>
    <p:wizard showStepStatus="false" style="margin-top:10px;">
        
        <!-- Step 1: Personal Information -->
        <p:tab id="step1" title="Informations Personnelles">
            <h:panelGrid columns="2" cellpadding="8" style="width:100%;">
                <h:outputText value="√Çge :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.age}" />

                <h:outputText value="Score de Cr√©dit :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.scoreCredit}" />

                <h:outputText value="Statut d'Emploi :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.statutEmploi}" />

                <h:outputText value="Statut Matrimonial :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.statutMatrimonial}" />

                <h:outputText value="Statut de Propri√©t√© :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.statutPropriete}" />
            </h:panelGrid>
        </p:tab>

        <!-- Step 2: Financial Behavior -->
        <p:tab id="step2" title="Comportement Financier">
            <h:panelGrid columns="2" cellpadding="8" style="width:100%;">
                <h:outputText value="Paiements Mensuels de Dettes :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.paiementsMensuelsDette} TND" />

                <h:outputText value="Utilisation Carte Cr√©dit :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.tauxUtilisationCarteCredit} %" />

                <h:outputText value="Nombre de Lignes de Cr√©dit Ouvertes :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.nombreLignesCreditOuvertes}" />

                <h:outputText value="Nombre de Demandes de Cr√©dit :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.nombreDemandesCredit}" />

                <h:outputText value="D√©faut de Pr√™t :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.precedentsDefautsPret eq 1 ? 'Oui' : 'Non'}" />

                <h:outputText value="Historique de Faillite :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.historiqueFaillite eq 1 ? 'Oui' : 'Non'}" />

                <h:outputText value="Historique Paiement (mois) :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.historiquePaiement}" />

                <h:outputText value="Dur√©e Historique Cr√©dit (mois) :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.dureeHistoriqueCredit}" />

                <h:outputText value="Actifs Totaux :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.actifsTotaux} TND" />

                <h:outputText value="Passifs Totaux :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.passifsTotaux} TND" />

                <h:outputText value="Valeur Nette :" styleClass="label" />
                <h:outputText value="#{clientProfileController.clientProfile.valeurNette} TND" />
            </h:panelGrid>
        </p:tab>

    </p:wizard>

    <p:separator style="margin:20px 0;" />

    <!-- üìä Simulation Data Section -->
    <h3 style="margin-top:10px;">üìä Simulation de Cr√©dit</h3>
    <h:panelGroup rendered="#{not empty folderBean.selectedFolder.demandeCredit}">
        <h:panelGrid columns="2" cellpadding="8" style="width:100%;">
            <h:outputText value="üìÜ Mensualit√© Estim√©e :" styleClass="label" />
            <h:outputText value="#{folderBean.selectedFolder.demandeCredit.mensualiteEstimee} TND" />

            <h:outputText value="üìâ Taux d'Endettement Apr√®s :" styleClass="label" />
            <h:outputText value="#{folderBean.selectedFolder.demandeCredit.tauxEndettement} %" />

            <h:outputText value="üìà Taux d'Endettement Avant :" styleClass="label" />
            <h:outputText value="#{folderBean.selectedFolder.demandeCredit.tauxEndettementAvant} %" />
            <h:outputText value="#{simulationController.getAdviceForFolderSimulation()}" 
                  rendered="#{not empty simulationController.demandeCreditBySelectedFolder}"
                  style="display:block; font-style:italic; color:#777; margin-bottom:20px;" />
        </h:panelGrid>
    </h:panelGroup>
    
    <!-- üîç R√©sultat de l'√âvaluation -->
<h3 style="margin-top:20px;">üîç R√©sultat de l'√âvaluation</h3>

<h:panelGroup rendered="#{not empty clientProfileController.clientProfile.pretApprouve}">
    <h:panelGrid columns="2" cellpadding="8" style="width:100%;">
        <h:outputText value="D√©cision Pr√™t :" styleClass="label" />
        <h:outputText value="#{clientProfileController.clientProfile.pretApprouve ? '‚úÖ Pr√™t approuv√©' : '‚ùå Pr√™t refus√©'}" style="font-weight:bold" />

        <h:outputText value="Probabilit√© d'Approbation :" styleClass="label" />
        <h:outputText value="#{clientProfileController.clientProfile.probabiliteApprobation} %" />

        <h:outputText value="Score Risque :" styleClass="label" />
        <h:outputText value="#{clientProfileController.clientProfile.scoreRisque}" />
    </h:panelGrid>
</h:panelGroup>

<h:panelGroup rendered="#{empty clientProfileController.clientProfile.pretApprouve}">
    <h:outputText value="Ce dossier n'a pas encore √©t√© √©valu√©." style="color:gray;" />
</h:panelGroup>
    

    <h:panelGroup rendered="#{empty folderBean.selectedFolder.demandeCredit}">
        <h:outputText value="Aucune simulation enregistr√©e pour ce dossier." style="color:gray;" />
    </h:panelGroup>

</p:dialog>
        <div class="details-flex">
            <div class="left">
                <h:panelGrid columns="2" cellpadding="6" columnClasses="label,value">
                    <h:outputLabel value="R√©f√©rence :" />
                    <h:outputText value="#{folderBean.selectedFolder.reference}" />

                    <h:outputLabel value="Client :" />
                    <h:outputText value="#{folderBean.selectedFolder.client}" />
                    
                    <h:outputLabel value="Analyste Assign√© :" />
                    <h:outputText value="#{folderBean.selectedFolder.assignedTo.firstName} #{folderBean.selectedFolder.assignedTo.lastName}" />
                    
                    <h:outputLabel value="Cr√©√© par :" />
                    <h:outputText value="#{folderBean.selectedFolder.createdBy.firstName} #{folderBean.selectedFolder.createdBy.lastName}" />

                    <h:outputLabel value="Statut :" />
                    <h:outputText value="#{folderBean.selectedFolder.navigation}" />
                </h:panelGrid>

                      <p:separator/>
                      <h3 style="margin-top:20px; color: #333;">üìé Pi√®ces Jointes du Dossier</h3>

<ui:repeat value="#{agencyDocumentController.documentsForSelectedFolder}" var="doc">
    <div style="
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 15px;
        margin-bottom: 10px;
        background-color: #f9f9f9;
        border-left: 5px solid #4CAF50;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.05);">

        <!-- File Info -->
        <div style="flex-grow: 1;">
            <i class="pi pi-file" style="color: #4CAF50; margin-right: 8px;"></i>
            <strong>#{doc.fileName}</strong>
            <span style="color: #888; font-size: 0.9em;"> | üìÖ #{doc.uploadDate}</span>
        </div>

        <!-- Download Button -->
        <div>
            <p:commandLink ajax="false" immediate="true"
                           style="text-decoration: none; color: #007bff;">
                <p:fileDownload value="#{agencyDocumentController.download(doc)}" />
                <i class="pi pi-download" style="margin-left: 5px;"></i> T√©l√©charger
            </p:commandLink>
        </div>
    </div>
</ui:repeat>

<h:outputText rendered="#{empty agencyDocumentController.documentsForSelectedFolder}"
              value="‚ùóAucun document trouv√© pour ce dossier."
              style="color: #777; font-style: italic;" />
              <br/>
        
<p:commandButton value="Ajouter une pi√®ce jointe"
                 icon="pi pi-plus"
                 rendered="#{folderBean.selectedFolder.navigation eq 'ASSIGNE_A_ANALYSTE' 
                 or folderBean.selectedFolder.navigation eq 'ENVOYE_AU_RESPONSABLE_ANALYSTE' }"
                 onclick="PF('uploadDialog').show();"
                 styleClass="my-button my-button-success"
                 style="font-size: 14px; margin-top: 15px;  padding: 6px 8px; border-radius: 5px;" />
<p:separator />
                <h3>üí¨ Historique des √©changes</h3>

<div style="max-height: 500px; width:1000px; overflow-y: auto; padding: 10px; background-color: #f1f1f1; border-radius: 10px;">
    <ui:repeat value="#{folderBean.actionsForSelectedFolder}" var="action" varStatus="status">
        <div style="
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 10px;
            background-color: #{action.user.username eq userController.currentUser.username ? '#d1e7dd' : '#ffffff'};
            align-self: #{action.user.username eq userController.currentUser.username ? 'flex-end' : 'flex-start'};
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        ">
            <div style="font-weight: bold; color: #333;">
                üë§ #{action.user.firstName} #{action.user.lastName} | <i>#{action.user.role}</i>
                <span style="float: right; color: #888; font-size: 0.85em;">üìÖ #{action.actionDate}</span>
            </div>
            <div style="margin-top: 5px; color: #444;">
                üìù #{action.comment}
            </div>
        </div>
    </ui:repeat>
</div>
                

                <!-- üîΩ Action Panel -->
                <p:separator/>
<h:panelGroup rendered="#{folderBean.selectedFolder.navigation eq 'ASSIGNE_A_ANALYSTE' 
or folderBean.selectedFolder.navigation eq 'ENVOYE_AU_RESPONSABLE_ANALYSTE'}">
    <h3>‚úçÔ∏è Commentaire et Action</h3>

    <!-- Commentaire input -->
    <p:inputTextarea value="#{folderBean.newComment}" rows="3" cols="40" autoResize="true" />

    <!-- Buttons + Analyst Assign in same footer -->
    <div class="comment-footer" style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">

         <!-- Approve -->
        <p:commandButton value="Valider"
                         icon="pi pi-check"
                         action="#{folderBean.handleResponsableDecision('approve')}"
                         update="responsableForm Ra2 Ra1"
                         styleClass="ui-button-success" />

        <!-- Reject -->
        <p:commandButton value="Rejeter"
                         icon="pi pi-times"
                         action="#{folderBean.handleResponsableDecision('reject')}"
                         update="responsableForm Ra2 Ra1"
                         styleClass="ui-button-danger" />
        <!-- Return -->
        <p:commandButton value="Retour au Charg√©"
                 icon="pi pi-undo"
                 action="#{folderBean.returnToChargeFromAnalyst}"
                 update="responsableForm Ra2 Ra1"
                 styleClass="ui-button-warning" />
                 
        <!-- Return offre  -->  
        <p:commandButton value="Retour offre"
                         action="#{folderBean.returnOfferToDirector}"
                         icon="pi pi-share-alt"
                         update="responsableForm Ra2 Ra1"
                         styleClass="ui-button-warning" /> 
                         
        <!-- send to director engagement -->
<p:commandButton value="Envoyer √† Directeur Engagement"
                 action="#{folderBean.sendToDirectorEngagement}"
                 icon="pi pi-send"
                 update="responsableForm Ra2 Ra1"
                 styleClass="ui-button-success" />
           <!-- send toSucc -->      
        <p:commandButton value="Envoyer au Responsable Succursale"
                 icon="pi pi-share-alt"
                 action="#{folderBean.sendToResponsableSuccursale}"
                 update="responsableForm Ra2 Ra1"
                 styleClass="ui-button-info"
                 rendered="#{folderBean.hasResponsableSuccursale(folderBean.selectedFolder)}"/>    
         <!-- send toCIC -->          
                 
        <p:commandButton value="AssignerCIC"
                             icon="pi pi-user-plus"
                             action="#{folderBean.assignToCICAnalyst}"
                             update="responsableForm Ra2 Ra1"
                             styleClass="ui-button-secondary"
                             />               
                               
        
        
    </div>
</h:panelGroup>


                
            </div>
        </div>
    </p:panel>
</h:form>

<!-- üîÅ POPUP Upload Dialog -->
<p:dialog header="Ajouter une pi√®ce jointe" widgetVar="uploadDialog" modal="true" resizable="false">
    <h:form id="uploadForm" enctype="multipart/form-data">
        <h:panelGrid columns="1" cellpadding="5">
            <h:outputLabel for="docName" value="Nom du fichier personnalis√©:"/>
            <p:inputText id="docName" value="#{agencyDocumentController.customFileName}" required="true" />

            <h:outputLabel for="fileUpload" value="S√©lectionner le fichier:"/>
            <p:fileUpload id="fileUpload"
                          value="#{agencyDocumentController.uploadedFile}"
                          mode="simple"
                          skinSimple="true"
                          required="true" />

            <p:commandButton value="Ajouter"
                             action="#{agencyDocumentController.upload}"
                             update="uploadForm Ra2"
                             oncomplete="PF('uploadDialog').hide();"
                             icon="pi pi-check" />
        </h:panelGrid>
    </h:form>
</p:dialog>

</h:body>
</html>
